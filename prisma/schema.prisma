// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// 발행 예정/완료 글
model Post {
  id            String   @id @default(uuid())
  date          DateTime // 발행 예정일
  scheduledAt   DateTime // 예정 발행 시간
  status        String   @default("PENDING") // PENDING, QUEUED, RUNNING, SUCCESS, FAIL, CANCELLED
  
  // 콘텐츠
  topicSeed     String?  // 원본 주제 시드
  title         String?  // 생성된 제목
  contentHtml   String?  // 본문 HTML
  keywords      String?  // 키워드 (JSON 배열)
  brandLinks    String?  // 브랜드커넥트 링크 (JSON 배열)
  category      String?  // 블로그 카테고리
  tags          String?  // 해시태그 (JSON 배열)
  tone          String?  // 글 톤 (친근한, 정보형 등)
  
  // 결과
  finalUrl      String?  // 발행된 글 URL
  screenshotPath String? // 성공 스크린샷 경로
  errorMessage  String?  // 실패 시 에러 메시지
  retryCount    Int      @default(0) // 재시도 횟수
  
  // 타임스탬프
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  publishedAt   DateTime? // 실제 발행 시간
  
  // 관계
  logs          Log[]
  
  @@index([date])
  @@index([status])
  @@index([scheduledAt])
}

// 실행 로그
model Log {
  id            String   @id @default(uuid())
  postId        String
  post          Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  
  action        String   // LOGIN, WRITE, PUBLISH, VERIFY 등
  status        String   // SUCCESS, FAIL
  message       String?  // 상세 메시지
  screenshotPath String? // 단계별 스크린샷
  
  createdAt     DateTime @default(now())
  
  @@index([postId])
  @@index([createdAt])
}

// 시스템 설정
model Setting {
  key       String   @id
  value     String   // JSON 형태로 저장
  updatedAt DateTime @updatedAt
}

// 세션 상태 (네이버 로그인 등)
model Session {
  id          String   @id @default(uuid())
  name        String   @unique // 'naver' 등
  isValid     Boolean  @default(false)
  lastChecked DateTime?
  expiresAt   DateTime?
  storagePath String?  // playwright storageState 파일 경로
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// 브랜드커넥트 링크 관리
model BrandLink {
  id          String   @id @default(uuid())
  url         String   // 브랜드커넥트 단축 URL (https://naver.me/xxx)
  
  // 스크래핑된 상품 정보
  productName String?  // 상품명
  productPrice String? // 가격
  storeName   String?  // 스토어명
  finalUrl    String?  // 리다이렉트된 최종 URL
  
  // 이미지 (JSON 배열)
  imageUrls   String?  // 스크래핑된 이미지 URL들
  
  // 발행 상태
  status      String   @default("READY") // READY, PUBLISHING, PUBLISHED, FAILED
  publishedAt DateTime?
  postUrl     String?  // 발행된 블로그 글 URL
  errorMessage String?
  
  // 메모
  memo        String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([status])
  @@index([createdAt])
}
